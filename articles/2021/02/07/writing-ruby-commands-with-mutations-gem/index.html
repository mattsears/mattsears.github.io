<html class="h-full antialiased js-focus-visible" data-js-focus-visible="" style="--header-position: sticky; --content-offset: 0px; --header-height: 64px; --header-mb: 0px; --avatar-image-transform: translate3d(0rem, 0, 0) scale(1); --avatar-border-transform: translate3d(-0.2222222222222222rem, 0, 0) scale(1.7777777777777777); --avatar-border-opacity: 0; --header-top: 0px; --avatar-top: 0px;" lang="en">
  <head>
  <meta charset="utf-8">

  
    <title>Matt Sears | Forget Service Objects, Write Command Objects in Ruby</title>
  
  <link rel="icon" href="/assets/images/me.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open Sans">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <script src="/assets/builds/application.js"></script>
  <link href="/assets/builds/application.css" rel="stylesheet" type="text/css" media="all" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Forget Service Objects, Write Command Objects in Ruby | Matt Sears</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Forget Service Objects, Write Command Objects in Ruby" />
<meta name="author" content="Matt Sears" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I mostly write about technology and business since that’s been my livelyhood for the past twenty years, but I also write about my other interests including music, traveling, and other random topics." />
<meta property="og:description" content="I mostly write about technology and business since that’s been my livelyhood for the past twenty years, but I also write about my other interests including music, traveling, and other random topics." />
<link rel="canonical" href="https://mattsears.com/articles/2021/02/07/writing-ruby-commands-with-mutations-gem/" />
<meta property="og:url" content="https://mattsears.com/articles/2021/02/07/writing-ruby-commands-with-mutations-gem/" />
<meta property="og:site_name" content="Matt Sears" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-07T21:53:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Forget Service Objects, Write Command Objects in Ruby" />
<script type="application/ld+json">
{"description":"I mostly write about technology and business since that’s been my livelyhood for the past twenty years, but I also write about my other interests including music, traveling, and other random topics.","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://mattsears.com/assets/images/me.png"},"name":"Matt Sears"},"url":"https://mattsears.com/articles/2021/02/07/writing-ruby-commands-with-mutations-gem/","headline":"Forget Service Objects, Write Command Objects in Ruby","dateModified":"2021-02-07T21:53:00+00:00","datePublished":"2021-02-07T21:53:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mattsears.com/articles/2021/02/07/writing-ruby-commands-with-mutations-gem/"},"author":{"@type":"Person","name":"Matt Sears"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body class="flex h-full flex-col bg-zinc-50 dark:bg-black">
    <div id="__next">
      <div class="fixed inset-0 flex justify-center sm:px-8">
        <div class="flex w-full max-w-7xl lg:px-8">
          <div class="w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20"></div>
        </div>
      </div>
      <div class="relative">
        <header class="pointer-events-none relative z-50 flex flex-col" style="height: 64px;">
  <div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)">
    <div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)">
      <div class="mx-auto max-w-7xl lg:px-8">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="relative flex gap-4">
              <div class="flex flex-1">
                <div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="Home" class="pointer-events-auto" href="/">
                  <img alt="" sizes="2.25rem" srcset="" src="/assets/images/me.png" decoding="async" data-nimg="future" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" style="color: transparent;" width="512" height="512"></a></div>
              </div>
              <div class="flex flex-1 justify-end md:justify-center">
                <div class="pointer-events-auto md:hidden" data-headlessui-state="">
                  <button class="group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20" id="headlessui-popover-button-:Rqb6:" type="button" aria-expanded="false" data-headlessui-state="">
                    Menu
                    <svg viewBox="0 0 8 6" aria-hidden="true" class="ml-3 h-auto w-2 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400">
                      <path d="M1.75 1.75 4 4.25l2.25-2.5" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                </div>
                
<nav class="pointer-events-auto hidden md:block">
  <ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10">
    
    <li>
      <a class="relative block px-3 py-2 transition  hover:text-teal-500 dark:hover:text-teal-400  " href="/">
        Home
        
      </a>
    </li>
    
    <li>
      <a class="relative block px-3 py-2 transition  hover:text-teal-500 dark:hover:text-teal-400  " href="/about/">
        About
        
      </a>
    </li>
    
    <li>
      <a class="relative block px-3 py-2 transition  hover:text-teal-500 dark:hover:text-teal-400  " href="/articles/">
        Journal
        
      </a>
    </li>
    
    <li>
      <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400 " href="#contact" data-name="matt" data-domain="mattsears" data-tld="com" onclick="window.location.href = 'mailto:' + this.dataset.name + '@' + this.dataset.domain + '.' + this.dataset.tld; return false;">Contact </a>
    </li>
  </ul>

</nav>



              </div>
              <div class="flex justify-end md:flex-1 ">
                <div class="pointer-events-auto ">
                  <button type="button"
                          aria-label="Toggle dark mode"
                          data-controller='toggle-mode'
                          data-action='click->toggle-mode#toggleMode'
                          class="group rounded-full bg-white/90 px-3 py-2 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20">
                    <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="h-6 w-6 fill-zinc-100 stroke-zinc-500 transition group-hover:fill-zinc-200 group-hover:stroke-zinc-700 dark:hidden [@media(prefers-color-scheme:dark)]:fill-teal-50 [@media(prefers-color-scheme:dark)]:stroke-teal-500 [@media(prefers-color-scheme:dark)]:group-hover:fill-teal-50 [@media(prefers-color-scheme:dark)]:group-hover:stroke-teal-600">
                      <path d="M8 12.25A4.25 4.25 0 0 1 12.25 8v0a4.25 4.25 0 0 1 4.25 4.25v0a4.25 4.25 0 0 1-4.25 4.25v0A4.25 4.25 0 0 1 8 12.25v0Z"></path>
                      <path d="M12.25 3v1.5M21.5 12.25H20M18.791 18.791l-1.06-1.06M18.791 5.709l-1.06 1.06M12.25 20v1.5M4.5 12.25H3M6.77 6.77 5.709 5.709M6.77 17.73l-1.061 1.061" fill="none"></path>
                    </svg>
                    <svg viewBox="0 0 24 24" aria-hidden="true" class="hidden h-6 w-6 fill-zinc-700 stroke-zinc-500 transition dark:block [@media(prefers-color-scheme:dark)]:group-hover:stroke-zinc-400 [@media_not_(prefers-color-scheme:dark)]:fill-teal-400/10 [@media_not_(prefers-color-scheme:dark)]:stroke-teal-500">
                      <path d="M17.25 16.22a6.937 6.937 0 0 1-9.47-9.47 7.451 7.451 0 1 0 9.47 9.47ZM12.75 7C17 7 17 2.75 17 2.75S17 7 21.25 7C17 7 17 11.25 17 11.25S17 7 12.75 7Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

        <main>
          <div class="sm:px-8 mt-16 lg:mt-32">
            <div class="mx-auto max-w-7xl lg:px-8">
              <div class="relative px-4 sm:px-8 lg:px-12">
                <div class="mx-auto max-w-2xl lg:max-w-5xl">
                  <div class="xl:relative">
                    <div class="mx-auto max-w-3xl">
                      
                      <a type="button" href="/articles/2021/03/30/hotwire-view-component-tailwind-css-a-new-era-in-ruby-on-rails-development/" aria-label="Go back to articles" class=" group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10 dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5 lg:mb-0 lg:-mt-2 xl:-top-1.5 xl:left-0 xl:mt-0">

                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15m0 0l6.75 6.75M4.5 12l6.75-6.75" />
                        </svg>
                      </a>
                      

                      
                      <a type="button" href="/articles/2021/01/26/creating-a-simple-rich-text-editor-with-quill-stimulus-and-tailwind-css/" aria-label="" class="group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10 dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-right-5 lg:mb-0 lg:-mt-2 xl:-top-1.5 xl:right-0 xl:mt-0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75" />
                        </svg>
                      </a>
                      


                      <article>
                        <header class="flex flex-col">
                          <h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-4xl">
                            Forget Service Objects, Write Command Objects in Ruby
                          </h1>
                          <time datetime="2021-02-07" class="order-first flex items-center text-base text-zinc-400 dark:text-zinc-500">
                            <span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
                            <span class="ml-3">February 07, 2021 </span>
                          </time>
                        </header>
                        <div class="mt-8 prose dark:prose-invert">
                          <p>The term “service object” can mean different things depending on who you talk to
or what project you inherited, hence why I put them in quotes. Since there’s not
really a “Rails Way” to put business logic, it was common to shove everything
into Active Record models. When that went awry, the concept of service objects
came onto the scene and provided a pathway for storing domain logic in plain
Ruby objects. <!--more--></p>

<p>Then something went terribly wrong with service objects - they got <em>too
fancy</em>. Sadly, there’s whole host of libraries designed to organize domain
logic, but lose sight on what makes Ruby great - <em>readability</em>. Libraries like
<a href="https://dry-rb.org/">dry-rb</a> that attempt to organize domain logic in a
standard way, but end up making the code much more difficult to understand IMHO.</p>

<p>I much prefer the concept of Command objects. Command closely aligns with
<em>procedure</em>. After all, that’s all we’re doing anyway - in between the controller
and the models, we’re running procedures, or commands, and returning the
result. I’m going to show you how I use command objects in my Rails apps
with the help from <a href="https://github.com/cypriss/mutations">Mutations</a>, a gem that
takes a somewhat hands-off approach to composing business logic by <em>not</em> obscuring
business logic with fancy abstractions, rather it merely providing helpful tools to
write clear business operations in ruby objects.</p>

<p>Let’s say you’ve been assigned a new project. The project has a page that
allows you to search and sort a list of users from the database. To your horror,
you discover the following code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="s2">"active=true"</span>
    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">"order by </span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:order_by</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:order_by</span><span class="p">]</span>
    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">"and name=</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">"and email=</span><span class="si">#{</span><span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">]</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">json</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We’ve probably all seen code like this (and much worse) time and time again. We not only have business logic in
our controllers, it’s also not flexible, not secure, hard to test, and
definitely error-prone. Let’s clean this up by calling our new a command object instead.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">search</span> <span class="o">=</span> <span class="no">Users</span><span class="o">::</span><span class="no">Search</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">search</span><span class="p">.</span><span class="nf">success?</span>
        <span class="vi">@users</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">result</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span>
      <span class="k">else</span>
        <span class="n">render</span> <span class="n">search</span><span class="p">.</span><span class="nf">errors</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Much cleaner and readable. We’ve replaced all the ugly forged sql code with just one line, a command called
<code class="language-plaintext highlighter-rouge">Users::Search.run(params)</code>. This Ruby object will contain all the code
necessary to search users based on the arguments we send to it and return the results. By the way, I
organize command objects in Rails projects like this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app/commands/users/create.rb
app/commands/users/delete.rb
app/commands/users/search.rb
...
</code></pre></div></div>

<p>It’s pretty clear what these commands do and we can even read it backwards,
<em>search users command in application</em> and <em>create user command in application</em>,
and it’s still obvious what these objects do.</p>

<p>For our user search, we have a couple options on how we
search for users in our database. We could use a 500 horsepower engine like
<a href="https://www.elastic.co/elasticsearch/">Elastic Search</a>, but we’re going to keep
it simple and use ActiveRecord for now. The nice thing about using a command
object, is that it hides the implementation from our caller. So all the code
that calls <code class="language-plaintext highlighter-rouge">Users::Search.run(params)</code> (i.e. Api controllers, background jobs,
rake tasks, whatever) won’t need to change. This could be important if later we decide to
search for users using Elastic Search instead. Here’s what our command object
looks like:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /app/commands/users/search.rb</span>

<span class="k">class</span> <span class="nc">Users::Search</span> <span class="o">&lt;</span> <span class="no">Mutations</span><span class="o">::</span><span class="no">Command</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-]+(\.[a-z\d\-]+)*\.[a-z]+\z/i</span>

  <span class="n">optional</span> <span class="k">do</span>
    <span class="n">string</span>  <span class="ss">:name</span>
    <span class="n">string</span>  <span class="ss">:email</span><span class="p">,</span> <span class="ss">matches: </span><span class="no">VALID_EMAIL_REGEX</span>
    <span class="n">string</span>  <span class="ss">:order_by</span>
    <span class="n">string</span>  <span class="ss">:direction</span><span class="p">,</span> <span class="ss">in: </span><span class="sx">%w(desc asc)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">execute</span>
    <span class="n">build_scope</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">build_scope</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="n">search_names</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="n">search_emails</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="n">sort_users</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="n">scope</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_names</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scope</span> <span class="k">unless</span> <span class="nb">name</span>

    <span class="n">scope</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_emails</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scope</span> <span class="k">unless</span> <span class="n">email</span>

    <span class="n">scope</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">email: </span><span class="n">email</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_users</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scope</span> <span class="k">unless</span> <span class="n">order_by</span>

    <span class="n">scope</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">order_by</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">sort_direction</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Let’s breaks this down. First, we’re inheriting from <code class="language-plaintext highlighter-rouge">Mutations::Command</code> class which
gives us the nice set of tools. Most notably the <code class="language-plaintext highlighter-rouge">optional</code> block that allows us
define all the parameters that we will accept. Conversely, we could force the
caller to pass in certain parameters with the <code class="language-plaintext highlighter-rouge">required</code> block. In these
blocks, we can also validate and sanitize the input so if anything unexpected is
passed to our command object, Mutations will declare it failed. For example,
let’s try to run the command with an improper email address:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;</span> search <span class="o">=</span> Users::Search.run<span class="o">(</span>email: <span class="s1">'wrong@format'</span><span class="o">)</span>
<span class="o">&gt;&gt;</span> search.success?
<span class="nb">false</span>
<span class="o">&gt;&gt;</span> search.errors.message
<span class="o">{</span>
  <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"Email isn't in the right format"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Another cool thing about the arguments we pass in, is that they become more or
less variables that we have access to during the execution. For example,
<code class="language-plaintext highlighter-rouge">email</code>, and <code class="language-plaintext highlighter-rouge">name</code> have values that we can use anywhere in our class. In this
case, we’re searching the database for users based on information we sent
in. We’re doing this by building our ActiveRecord
<a href="https://guides.rubyonrails.org/active_record_querying.html#scopes">scopes</a>
dynamically - chaining scopes if our (optional) parameters have values.</p>

<p>The <code class="language-plaintext highlighter-rouge">execute</code> method is where we put the code that we want to run when
<code class="language-plaintext highlighter-rouge">Users::Search.run</code> is called. Mutations stays out of our way here, giving us
the freedom to do what we want in this method. There’s no fancy DSL that we have
to follow and no binding BS. The result of this method will be assigned to a
variable called <code class="language-plaintext highlighter-rouge">result</code>. In our case, we’re building ActiveRecord scopes and at
the end, returning <code class="language-plaintext highlighter-rouge">scope</code>. Let’s see it in action.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>search <span class="o">=</span> Users::Search.run<span class="o">(</span>name: <span class="s1">'Matt'</span>, order_by: <span class="s1">'created_at'</span>,
  direction: <span class="s1">'desc'</span><span class="o">)</span>

<span class="o">&gt;&gt;</span> search.result
<span class="o">[</span><span class="c">#&lt;User:0x00007fa2ccd234hC&gt;,&lt;User:0x00007fa2ccd123sac&gt;, &lt;User:0x00007fa2ccdsad9w&gt;]</span>

<span class="o">&gt;&gt;</span> search.result.class
User::ActiveRecord_Relation &lt; ActiveRecord::Relation

<span class="o">&gt;&gt;</span> search.result.to_sql
<span class="s2">"SELECT </span><span class="se">\"</span><span class="s2">users</span><span class="se">\"</span><span class="s2">.* FROM </span><span class="se">\"</span><span class="s2">users</span><span class="se">\"</span><span class="s2"> WHERE </span><span class="se">\"</span><span class="s2">users</span><span class="se">\"</span><span class="s2">.</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> = 'Matt'
    ORDER BY created_at desc
</span></code></pre></div></div>

<p>Service objects may have their place, but I much rather see a project with a set
of commands that clearly defines intent both in logic and in naming.</p>

                        </div>
                      </article>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
        
<footer class="mt-24">
  <div class="sm:px-8">
    <div class="mx-auto max-w-7xl lg:px-8">
      <div class="border-t border-zinc-100 pt-10 pb-16 dark:border-zinc-700/40">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
              <div class="flex gap-6 text-sm font-medium text-zinc-800 dark:text-zinc-200">
                <a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/">Home</a>
                <a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/about">About</a>
                <a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/work">Work</a>
                <a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/articles">Journal</a>
              </div>
              <p class="text-sm text-zinc-400 dark:text-zinc-500">
                © 2023 Matt Sears. All rights reserved.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

      </div>
    </div>
  </body>
</html>
